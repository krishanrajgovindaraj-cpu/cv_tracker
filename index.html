<!DOCTYPE html>
<html>
<head>
  <title>Ozellar Marine CV Tracker</title>
  <style>
    body { font-family: Arial; margin: 30px; background-color: #f9f9f9; }
    h1 { color: orange; text-align: center; }
    h2 { text-align: center; }
    label { display: block; margin-top: 15px; }
    input[type="text"], input[type="date"], select {
      width: 300px; padding: 5px; margin-top: 5px;
    }
    button { margin-top: 20px; padding: 5px 10px; cursor: pointer; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; background: #fff; }
    th, td { border: 1px solid #000; padding: 5px; white-space: nowrap; }
    .deleteBtn { background-color: red; color: white; border: none; padding: 3px 8px; }
    .editBtn { background-color: green; color: white; border: none; padding: 3px 8px; margin-right: 5px; }
    #totalCount { text-align: center; margin-top: 20px; }
  </style>
</head>

<body>

<h1>Ozellar Marine</h1>
<h2>CV Live</h2>

<label>Name:
  <input type="text" id="name" placeholder="Enter full name">
</label>

<label>Rank:
  <select id="rank">
    <option value="">--Select Rank--</option>
    <option>Master</option>
    <option>Chief Officer</option>
    <option>Second Officer</option>
    <option>Third Officer</option>
    <option>Deck Cadet</option>
    <option>Chief Engineer</option>
    <option>Second Engineer</option>
    <option>Third Engineer</option>
    <option>Fourth Engineer</option>
    <option>Engine Cadet</option>
    <option>Electrical Engineer</option>
    <option>Electro-Technical Officer</option>
    <option>Motorman</option>
    <option>Fitter</option>
    <option>Oiler</option>
    <option>Cook</option>
    <option>GS</option>
    <option>Other</option>
  </select>
</label>

<label>Email:
  <input type="text" id="email" placeholder="Enter email">
</label>

<label>Contact Number:
  <input type="text" id="number" placeholder="Enter contact number">
</label>

<label>CV Collecting Date:
  <input type="date" id="cvDate">
</label>

<label>Remarks:
  <input type="text" id="remarks" placeholder="Any remarks">
</label>

<button id="submitBtn">Submit</button>
<button id="exportBtn">Export to Excel</button>
<button id="clearBtn">Clear All CVs</button>

<h3 id="totalCount">Total CVs: 0</h3>

<table>
  <thead>
    <tr>
      <th>Sr.No</th>
      <th>Name</th>
      <th>Rank</th>
      <th>Email</th>
      <th>Contact Number</th>
      <th>CV Collecting Date</th>
      <th>Remarks</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="cvTableBody"></tbody>
</table>

<script>
let cvList = JSON.parse(localStorage.getItem("cvList")) || [];
let lastSrNo = Number(localStorage.getItem("lastSrNo")) || 0;
let editIndex = null;

// DISPLAY
function displayCVList() {
  const tbody = document.getElementById("cvTableBody");
  tbody.innerHTML = "";

  cvList.forEach((cv, index) => {
    tbody.innerHTML += `
      <tr>
        <td>${cv.srNo}</td>
        <td>${cv.name}</td>
        <td>${cv.rank}</td>
        <td>${cv.email}</td>
        <td>${cv.number}</td>
        <td>${cv.cvDate}</td>
        <td>${cv.remarks}</td>
        <td>
          <button class="editBtn" onclick="editEntry(${index})">Edit</button>
          <button class="deleteBtn" onclick="deleteEntry(${index})">Delete</button>
        </td>
      </tr>
    `;
  });

  document.getElementById("totalCount").textContent =
    "Total CVs: " + cvList.length;
}

// RESET FORM
function resetForm() {
  document.getElementById("name").value = "";
  document.getElementById("rank").value = "";
  document.getElementById("email").value = "";
  document.getElementById("number").value = "";
  document.getElementById("cvDate").value = "";
  document.getElementById("remarks").value = "";
  editIndex = null;
  document.getElementById("submitBtn").textContent = "Submit";
}

// EDIT
function editEntry(index) {
  const cv = cvList[index];
  document.getElementById("name").value = cv.name;
  document.getElementById("rank").value = cv.rank;
  document.getElementById("email").value = cv.email;
  document.getElementById("number").value = cv.number;
  document.getElementById("cvDate").value = cv.cvDate;
  document.getElementById("remarks").value = cv.remarks;
  editIndex = index;
  document.getElementById("submitBtn").textContent = "Save Changes";
}

// DELETE
function deleteEntry(index) {
  if (confirm("Are you sure you want to delete this entry?")) {
    cvList.splice(index, 1);
    localStorage.setItem("cvList", JSON.stringify(cvList));
    displayCVList();
    resetForm();
  }
}

// SUBMIT
document.getElementById("submitBtn").addEventListener("click", () => {
  const name = document.getElementById("name").value.trim();
  const rank = document.getElementById("rank").value;
  const email = document.getElementById("email").value.trim();
  const number = document.getElementById("number").value.trim();
  const cvDate = document.getElementById("cvDate").value;
  const remarks = document.getElementById("remarks").value.trim();

  if (!name || !rank || !number) {
    alert("Please fill Name, Rank and Contact Number");
    return;
  }

  if (email && !/^\S+@\S+\.\S+$/.test(email)) {
    alert("Please enter a valid email");
    return;
  }

  const duplicate = cvList.some((cv, idx) => cv.number === number && idx !== editIndex);
  if (duplicate) {
    alert("This contact number already exists!");
    return;
  }

  if (editIndex !== null) {
    cvList[editIndex] = {
      ...cvList[editIndex],
      name, rank, email, number, cvDate, remarks
    };
  } else {
    lastSrNo++;
    cvList.push({
      srNo: lastSrNo,
      name, rank, email, number, cvDate, remarks
    });
    localStorage.setItem("lastSrNo", lastSrNo);
  }

  localStorage.setItem("cvList", JSON.stringify(cvList));
  displayCVList();
  resetForm();
});

// EXPORT CSV
document.getElementById("exportBtn").addEventListener("click", () => {
  if (cvList.length === 0) {
    alert("No data to export!");
    return;
  }

  let csv = "Sr.No,Name,Rank,Email,Contact Number,CV Date,Remarks\n";
  cvList.forEach(cv => {
    csv += `${cv.srNo},"${cv.name}","${cv.rank}","${cv.email}","${cv.number}","${cv.cvDate}","${cv.remarks}"\n`;
  });

  const link = document.createElement("a");
  link.href = "data:text/csv;charset=utf-8," + encodeURIComponent(csv);
  link.download = "CV_List.csv";
  link.click();
});

// CLEAR ALL
document.getElementById("clearBtn").addEventListener("click", () => {
  if (confirm("Are you sure you want to delete all CVs?")) {
    localStorage.clear();
    cvList = [];
    lastSrNo = 0;
    displayCVList();
    resetForm();
  }
});

// INITIAL LOAD
displayCVList();
</script>

</body>
</html>
